<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KING AI | Premium Intelligence</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');

        :root {
            --brand-primary: #6366f1;
            --brand-secondary: #4f46e5;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
        }

        /* Smooth Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }

        /* Typography */
        .message-content pre { 
            background: #1e293b !important; 
            padding: 1.25rem !important;
            border-radius: 12px;
            margin: 1rem 0;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Mobile Layout Utilities */
        #chat-window { height: calc(100dvh - 160px); }
        
        @media (max-width: 768px) {
            #sidebar { 
                transform: translateX(-100%); 
                transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            }
            #sidebar.open { transform: translateX(0); }
        }

        /* Professional Animations */
        .typing-cursor::after {
            content: "";
            display: inline-block;
            width: 8px;
            height: 18px;
            background: var(--brand-primary);
            margin-left: 4px;
            vertical-align: middle;
            animation: blink 0.8s infinite;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .dark .glass {
            background: rgba(15, 23, 42, 0.8);
        }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        king: {
                            50: '#f5f7ff',
                            100: '#ebf0fe',
                            600: '#6366f1',
                            700: '#4f46e5',
                            900: '#0f172a',
                            950: '#020617'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-king-50 dark:bg-king-950 text-slate-800 dark:text-slate-200 transition-colors duration-300">

    <div id="loading-overlay" class="fixed inset-0 z-[100] flex items-center justify-center bg-white dark:bg-king-950">
        <div class="flex flex-col items-center">
            <div class="relative w-16 h-16">
                <div class="absolute inset-0 border-4 border-king-600/20 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-king-600 border-t-transparent rounded-full animate-spin"></div>
            </div>
            <h2 class="mt-6 text-xl font-bold tracking-tighter text-king-600 uppercase">King AI</h2>
            <p class="text-xs text-slate-400 mt-1 uppercase tracking-widest font-medium">By Tausif Islam</p>
        </div>
    </div>

    <div id="app-root" class="flex min-h-screen relative overflow-hidden hidden">
        
        <aside id="sidebar" class="fixed md:relative z-40 w-80 h-full bg-white dark:bg-king-900 border-r border-slate-200 dark:border-slate-800 flex flex-col shadow-2xl md:shadow-none">
            <div class="p-6">
                <div class="flex items-center gap-3 mb-8">
                    <div class="w-10 h-10 bg-gradient-to-tr from-king-600 to-indigo-400 rounded-xl flex items-center justify-center shadow-lg shadow-king-600/30">
                        <i data-lucide="crown" class="text-white w-6 h-6"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold tracking-tight">KING AI</h1>
                        <p class="text-[10px] text-slate-400 uppercase font-bold tracking-tighter">Premium Intelligence</p>
                    </div>
                </div>

                <button onclick="createNewChat()" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-king-600 hover:bg-king-700 text-white rounded-xl transition-all font-semibold shadow-md hover:shadow-lg active:scale-95">
                    <i data-lucide="plus" class="w-4 h-4"></i> New Conversation
                </button>
            </div>

            <div id="chat-history" class="flex-1 overflow-y-auto px-4 space-y-2">
                </div>

            <div class="p-6 border-t border-slate-100 dark:border-slate-800 space-y-4">
                <div class="flex items-center justify-between">
                    <button onclick="toggleDarkMode()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">
                        <i data-lucide="moon" class="w-5 h-5"></i>
                    </button>
                    <button onclick="openSettings()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-lg transition-colors">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="pt-2">
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em] mb-1">Creator</p>
                    <div class="flex items-center gap-2 text-sm font-medium text-slate-600 dark:text-slate-300">
                        <div class="w-6 h-6 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-[10px]">TI</div>
                        TAUSIF ISLAM
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col relative min-w-0 bg-white dark:bg-king-950">
            <nav class="h-16 flex items-center justify-between px-6 border-b border-slate-100 dark:border-slate-800 glass sticky top-0 z-30">
                <div class="flex items-center gap-4">
                    <button onclick="toggleSidebar()" class="md:hidden p-2 -ml-2">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <span id="current-chat-title" class="font-bold text-slate-700 dark:text-slate-100 truncate max-w-[180px] md:max-w-md">Untitled Session</span>
                </div>
                <div class="flex items-center gap-4">
                    <span class="hidden sm:flex items-center gap-2 px-3 py-1 bg-king-50 dark:bg-king-900 rounded-full text-[11px] font-bold text-king-600 border border-king-100 dark:border-king-800">
                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
                        <span id="model-indicator">deepseek-r1:free</span>
                    </span>
                </div>
            </nav>

            <div id="chat-window" class="flex-1 overflow-y-auto p-4 md:p-10 space-y-10">
                <div id="welcome-screen" class="h-full flex flex-col items-center justify-center max-w-xl mx-auto text-center space-y-8">
                    <div class="relative">
                        <div class="absolute inset-0 bg-king-600 blur-3xl opacity-10 animate-pulse"></div>
                        <i data-lucide="sparkles" class="w-16 h-16 text-king-600 relative"></i>
                    </div>
                    <div>
                        <h2 class="text-4xl font-extrabold tracking-tight mb-4">The King's Counsel</h2>
                        <p class="text-slate-500 dark:text-slate-400 leading-relaxed">Experience a faster, smarter, and more professional AI assistant. Connect your API to begin.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 w-full">
                        <div class="p-4 bg-slate-50 dark:bg-king-900/50 rounded-2xl text-left border border-slate-100 dark:border-slate-800">
                            <h4 class="text-xs font-bold uppercase tracking-wider text-king-600 mb-1">Knowledge</h4>
                            <p class="text-xs text-slate-500">DeepSeek & GPT-4 integrated architecture.</p>
                        </div>
                        <div class="p-4 bg-slate-50 dark:bg-king-900/50 rounded-2xl text-left border border-slate-100 dark:border-slate-800">
                            <h4 class="text-xs font-bold uppercase tracking-wider text-king-600 mb-1">Privacy</h4>
                            <p class="text-xs text-slate-500">History stored locally on your device.</p>
                        </div>
                    </div>
                </div>
                
                <div id="messages-list" class="max-w-4xl mx-auto space-y-10 pb-20"></div>
            </div>

            <div class="p-4 md:p-8 glass">
                <div class="max-w-4xl mx-auto">
                    <div class="relative flex items-end gap-2 bg-white dark:bg-king-900 border border-slate-200 dark:border-slate-700 rounded-2xl p-2 shadow-2xl shadow-king-900/10 focus-within:border-king-500 transition-all">
                        <textarea 
                            id="user-input"
                            rows="1"
                            placeholder="Ask King AI anything..."
                            class="flex-1 bg-transparent py-3 pl-4 outline-none resize-none text-[15px] max-h-48"
                            oninput="autoResize(this)"
                        ></textarea>
                        <button 
                            id="send-btn"
                            onclick="handleSendMessage()"
                            class="p-3 bg-king-600 hover:bg-king-700 text-white rounded-xl transition-all shadow-lg active:scale-90 disabled:opacity-50"
                        >
                            <i data-lucide="send" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="flex justify-center mt-3">
                        <p class="text-[10px] text-slate-400 font-medium">Built by <span class="text-slate-600 dark:text-slate-300">TAUSIF ISLAM</span> â€¢ 2026 Edition</p>
                    </div>
                </div>
            </div>
        </main>

        <div id="settings-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 bg-king-950/60 backdrop-blur-md">
            <div class="bg-white dark:bg-king-900 w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden border border-white/10">
                <div class="p-8 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold">System Settings</h3>
                        <p class="text-xs text-slate-500 mt-1">Configure your AI API parameters</p>
                    </div>
                    <button onclick="closeSettings()" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full"><i data-lucide="x"></i></button>
                </div>
                <div class="p-8 space-y-6">
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-slate-400">OpenRouter API Key</label>
                        <input type="password" id="api-key-input" class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-king-950 outline-none focus:ring-2 focus:ring-king-500" placeholder="sk-or-v1-...">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-slate-400">Preferred Model</label>
                        <input type="text" id="model-input" class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-king-950 outline-none focus:ring-2 focus:ring-king-500">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-slate-400">System Instruction</label>
                        <textarea id="system-prompt-input" rows="3" class="w-full p-4 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-king-950 outline-none focus:ring-2 focus:ring-king-500"></textarea>
                    </div>
                </div>
                <div class="p-8 bg-slate-50 dark:bg-king-950/50 flex justify-end gap-3">
                    <button onclick="saveSettings()" class="w-full py-4 bg-king-600 text-white rounded-xl font-bold hover:bg-king-700 transition-all shadow-lg shadow-king-600/20">Apply Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let state = {
            chats: JSON.parse(localStorage.getItem('king_chats') || '[]'),
            currentChatId: null,
            settings: JSON.parse(localStorage.getItem('king_settings') || JSON.stringify({
                apiKey: '',
                model: 'deepseek/deepseek-r1:free',
                systemPrompt: 'You are King AI, a sophisticated and helpful professional assistant created by Tausif Islam.',
                darkMode: true
            }))
        };

        window.addEventListener('DOMContentLoaded', () => {
            if (state.settings.darkMode) document.documentElement.classList.add('dark');
            
            document.getElementById('api-key-input').value = state.settings.apiKey;
            document.getElementById('model-input').value = state.settings.model;
            document.getElementById('system-prompt-input').value = state.settings.systemPrompt;
            document.getElementById('model-indicator').innerText = state.settings.model;

            renderHistory();
            if (state.chats.length > 0) loadChat(state.chats[0].id);
            else createNewChat();

            setTimeout(() => {
                document.getElementById('loading-overlay').classList.add('hidden');
                document.getElementById('app-root').classList.remove('hidden');
                lucide.createIcons();
            }, 800);
        });

        function createNewChat() {
            const newChat = {
                id: Date.now().toString(),
                title: 'New Council',
                messages: [],
                timestamp: new Date().toISOString()
            };
            state.chats.unshift(newChat);
            state.currentChatId = newChat.id;
            saveState();
            renderHistory();
            renderMessages();
            closeSidebarOnMobile();
        }

        async function handleSendMessage() {
            const input = document.getElementById('user-input');
            const content = input.value.trim();
            if (!content || !state.settings.apiKey) return;

            const chat = state.chats.find(c => c.id === state.currentChatId);
            chat.messages.push({ role: 'user', content });
            if (chat.messages.length === 1) chat.title = content.slice(0, 30) + '...';
            
            input.value = '';
            input.style.height = 'auto';
            renderMessages();

            const aiMsg = { role: 'assistant', content: '' };
            chat.messages.push(aiMsg);
            
            const list = document.getElementById('messages-list');
            const lastMsgDiv = document.createElement('div');
            lastMsgDiv.className = "flex justify-start animate-in fade-in slide-in-from-bottom-2 duration-500";
            lastMsgDiv.innerHTML = `
                <div class="max-w-[85%] flex gap-5">
                    <div class="w-10 h-10 rounded-xl bg-king-600 text-white flex-shrink-0 flex items-center justify-center shadow-lg"><i data-lucide="crown" class="w-5 h-5"></i></div>
                    <div class="space-y-1">
                        <p class="text-[10px] font-black uppercase tracking-[0.2em] text-king-600">King AI</p>
                        <div class="message-content typing-cursor prose prose-slate dark:prose-invert max-w-none text-[15px] leading-relaxed"></div>
                    </div>
                </div>
            `;
            list.appendChild(lastMsgDiv);
            const contentContainer = lastMsgDiv.querySelector('.message-content');
            scrollToBottom();
            lucide.createIcons();

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${state.settings.apiKey}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: state.settings.model,
                        messages: [{ role: "system", content: state.settings.systemPrompt }, ...chat.messages.slice(0, -1)],
                        stream: true
                    })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') break;
                            try {
                                const parsed = JSON.parse(data);
                                const token = parsed.choices[0]?.delta?.content || "";
                                aiMsg.content += token;
                                contentContainer.innerHTML = marked.parse(aiMsg.content);
                                scrollToBottom();
                            } catch (e) {}
                        }
                    }
                }
            } catch (err) {
                contentContainer.innerText = "Connection failed. Verify API key in settings.";
            } finally {
                contentContainer.classList.remove('typing-cursor');
                saveState();
                Prism.highlightAll();
            }
        }

        function renderHistory() {
            const container = document.getElementById('chat-history');
            container.innerHTML = state.chats.map(chat => `
                <div onclick="loadChat('${chat.id}')" class="group flex items-center justify-between p-3.5 rounded-xl cursor-pointer transition-all ${state.currentChatId === chat.id ? 'bg-king-50 dark:bg-king-800/50 border border-king-100 dark:border-king-700' : 'hover:bg-slate-50 dark:hover:bg-king-800/30'}">
                    <div class="flex items-center gap-3 overflow-hidden">
                        <i data-lucide="message-circle" class="w-4 h-4 text-slate-400 group-hover:text-king-600 transition-colors"></i>
                        <span class="truncate text-sm font-medium ${state.currentChatId === chat.id ? 'text-king-600' : 'text-slate-500'}">${chat.title}</span>
                    </div>
                    <button onclick="deleteChat('${chat.id}', event)" class="opacity-0 group-hover:opacity-100 p-1 text-slate-400 hover:text-red-500"><i data-lucide="trash-2" class="w-3.5 h-3.5"></i></button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderMessages() {
            const chat = state.chats.find(c => c.id === state.currentChatId);
            const list = document.getElementById('messages-list');
            const welcome = document.getElementById('welcome-screen');
            
            if (!chat || chat.messages.length === 0) {
                list.innerHTML = '';
                welcome.classList.remove('hidden');
                return;
            }

            welcome.classList.add('hidden');
            list.innerHTML = chat.messages.map(msg => `
                <div class="flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} animate-in fade-in duration-500">
                    <div class="max-w-[85%] flex gap-5 ${msg.role === 'user' ? 'flex-row-reverse' : ''}">
                        <div class="w-10 h-10 rounded-xl flex-shrink-0 flex items-center justify-center shadow-lg ${msg.role === 'user' ? 'bg-slate-800 text-white' : 'bg-king-600 text-white'}">
                            <i data-lucide="${msg.role === 'user' ? 'user' : 'crown'}" class="w-5 h-5"></i>
                        </div>
                        <div class="space-y-1 ${msg.role === 'user' ? 'text-right' : ''}">
                            <p class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400">${msg.role === 'user' ? 'You' : 'King AI'}</p>
                            <div class="message-content prose prose-slate dark:prose-invert max-w-none text-[15px] leading-relaxed">
                                ${marked.parse(msg.content)}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            Prism.highlightAll();
            scrollToBottom();
            lucide.createIcons();
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
        function closeSidebarOnMobile() { if (window.innerWidth < 768) toggleSidebar(); }
        function loadChat(id) { state.currentChatId = id; renderMessages(); renderHistory(); document.getElementById('current-chat-title').innerText = state.chats.find(c => c.id === id).title; closeSidebarOnMobile(); }
        function deleteChat(id, e) { e.stopPropagation(); state.chats = state.chats.filter(c => c.id !== id); if (state.currentChatId === id) createNewChat(); else { saveState(); renderHistory(); } }
        function toggleDarkMode() { state.settings.darkMode = !state.settings.darkMode; document.documentElement.classList.toggle('dark'); saveState(); }
        function openSettings() { document.getElementById('settings-modal').classList.remove('hidden'); }
        function closeSettings() { document.getElementById('settings-modal').classList.add('hidden'); }
        function saveSettings() {
            state.settings.apiKey = document.getElementById('api-key-input').value;
            state.settings.model = document.getElementById('model-input').value;
            state.settings.systemPrompt = document.getElementById('system-prompt-input').value;
            document.getElementById('model-indicator').innerText = state.settings.model;
            saveState();
            closeSettings();
        }
        function saveState() { 
            localStorage.setItem('king_chats', JSON.stringify(state.chats)); 
            localStorage.setItem('king_settings', JSON.stringify(state.settings)); 
        }
        function autoResize(t) { t.style.height = 'auto'; t.style.height = t.scrollHeight + 'px'; }
        function scrollToBottom() { const c = document.getElementById('chat-window'); c.scrollTop = c.scrollHeight; }

        document.getElementById('user-input').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey && window.innerWidth > 768) {
                e.preventDefault();
                handleSendMessage();
            }
        });
    </script>
</body>
</html>
